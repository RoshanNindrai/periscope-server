# Queue Worker Management with systemd
# Native systemd service for Laravel queue worker (Amazon Linux 2023 compatible)

files:
  # Add queue worker logs to EB log tailing
  "/opt/elasticbeanstalk/tasks/taillogs.d/queue-worker.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/app/current/storage/logs/laravel.log
      /var/app/current/storage/logs/queue-worker.log

container_commands:
  # Fix staging storage permissions to prevent deployment errors
  01-fix-staging-permissions:
    command: |
      mkdir -p /var/app/staging/storage/logs /var/app/staging/storage/framework/cache /var/app/staging/storage/framework/sessions /var/app/staging/storage/framework/views
      chown -R webapp:webapp /var/app/staging/storage /var/app/staging/bootstrap/cache || true
      chmod -R 775 /var/app/staging/storage /var/app/staging/bootstrap/cache || true
    leader_only: false
